<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>

</head>

<body>
    <div class="" onclick="start()">start</div>

    <div id="result"></div>
</body>
<script>
    let mediaRecorder;
    let audioChunks = [];

    const startBtn = document.getElementById("startBtn");
    const stopBtn = document.getElementById("stopBtn");
    const audioPlayback = document.getElementById("audioPlayback");

    startBtn.addEventListener("click", async () => {
        // درخواست دسترسی به میکروفون
        const stream = await navigator.mediaDevices.getUserMedia({ audio: true });

        mediaRecorder = new MediaRecorder(stream);

        // هر chunk که آماده شد، ذخیره می‌کنیم
        mediaRecorder.ondataavailable = (event) => {
            if (event.data.size > 0) {
                audioChunks.push(event.data);
            }
        };

        // وقتی ضبط متوقف شد، یک فایل صوتی بسازیم
        mediaRecorder.onstop = () => {
            const audioBlob = new Blob(audioChunks, { type: "audio/webm" });
            const audioUrl = URL.createObjectURL(audioBlob);
            audioPlayback.src = audioUrl;
            audioChunks = []; // پاک کردن chunks برای ضبط بعدی
        };

        mediaRecorder.start();
        console.log("ضبط شروع شد");
    });

    stopBtn.addEventListener("click", () => {
        if (mediaRecorder && mediaRecorder.state !== "inactive") {
            mediaRecorder.stop();
            console.log("ضبط متوقف شد");
        }
    });
</script>

</html>